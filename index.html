<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Blitz</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        canvas {
            border: 2px solid #333;
            background-color: #fff;
            display: none;
        }
        #menu, #loginScreen, #characterScreen, #mapScreen {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        #menu h1, #loginScreen h2, #characterScreen h2, #mapScreen h2 {
            margin: 0 0 20px;
        }
        button, input {
            padding: 10px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .character-option, .map-option {
            display: inline-block;
            margin: 10px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .character-option:hover, .map-option:hover {
            border: 2px solid #333;
        }
        .character-option img, .map-option img {
            width: 64px;
            height: 64px;
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>Battle Blitz</h1>
        <button onclick="showLogin()">Play</button>
        <button onclick="alert('Settings not implemented')">Settings</button>
    </div>
    <div id="loginScreen" style="display: none;">
        <h2>Login / Register</h2>
        <input type="text" id="username" placeholder="Username"><br>
        <input type="password" id="password" placeholder="Password"><br>
        <button onclick="login()">Login</button>
        <button onclick="register()">Register</button>
        <button onclick="showMenu()">Back</button>
    </div>
    <div id="characterScreen" style="display: none;">
        <h2>Select Character</h2>
        <div class="character-option" onclick="selectCharacter('warrior')">
            <img src="https://via.placeholder.com/32/FF0000" alt="Warrior">
            <p>Warrior (High Health)</p>
        </div>
        <div class="character-option" onclick="selectCharacter('archer')">
            <img src="https://via.placeholder.com/32/00FF00" alt="Archer">
            <p>Archer (Fast Attack)</p>
        </div>
        <div class="character-option" onclick="selectCharacter('scout')">
            <img src="https://via.placeholder.com/32/0000FF" alt="Scout">
            <p>Scout (High Speed)</p>
        </div>
        <button onclick="showLogin()">Back</button>
    </div>
    <div id="mapScreen" style="display: none;">
        <h2>Select Map</h2>
        <div class="map-option" onclick="selectMap('open')">
            <img src="https://via.placeholder.com/32/CCCCCC" alt="Open Field">
            <p>Open Field</p>
        </div>
        <div class="map-option" onclick="selectMap('fortress')">
            <img src="https://via.placeholder.com/32/666666" alt="Fortress">
            <p>Fortress</p>
        </div>
        <button onclick="showCharacterScreen()">Back</button>
    </div>
    <div id="controls">
        <p><strong>Controls:</strong></p>
        <p>WASD: Move</p>
        <p>Mouse: Aim & Shoot</p>
        <p>R: Restart</p>
    </div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game settings
        const MAP_WIDTH = canvas.width;
        const MAP_HEIGHT = canvas.height;
        const PLAYER_SIZE = 16;
        const BULLET_SIZE = 4;
        const POWERUP_SIZE = 16;

        // Game state
        let gameState = 'menu';
        let player = null;
        let bullets = [];
        let enemies = [];
        let powerUps = [];
        let otherPlayers = []; // Simulated multiplayer
        let walls = [];
        let score = 0;
        let currentMap = 'open';
        let currentUser = null;

        // Character stats
        const characters = {
            warrior: { health: 150, speed: 4, bulletCooldown: 600, sprite: 'https://via.placeholder.com/32/FF0000' },
            archer: { health: 100, speed: 5, bulletCooldown: 300, sprite: 'https://via.placeholder.com/32/00FF00' },
            scout: { health: 80, speed: 7, bulletCooldown: 500, sprite: 'https://via.placeholder.com/32/0000FF' }
        };

        // Map definitions
        const maps = {
            open: { walls: [] },
            fortress: {
                walls: [
                    { x: 200, y: 200, width: 400, height: 20 },
                    { x: 200, y: 400, width: 400, height: 20 },
                    { x: 200, y: 200, width: 20, height: 200 },
                    { x: 580, y: 200, width: 20, height: 200 }
                ]
            }
        };

        // Input handling
        let keys = {};
        let mouse = { x: 0, y: 0 };
        document.addEventListener('keydown', (e) => { keys[e.key.toLowerCase()] = true; });
        document.addEventListener('keyup', (e) => { keys[e.key.toLowerCase()] = false; });
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.clientX - rect.left;
            mouse.y = e.clientY - rect.top;
        });
        canvas.addEventListener('click', () => {
            if (gameState === 'playing' && player && Date.now() - player.lastShot >= player.bulletCooldown) {
                shootBullet(player);
                player.lastShot = Date.now();
                // const shootSound = new Audio('shoot.mp3'); shootSound.play();
            }
        });

        // Menu navigation
        function showMenu() {
            gameState = 'menu';
            document.getElementById('menu').style.display = 'block';
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('characterScreen').style.display = 'none';
            document.getElementById('mapScreen').style.display = 'none';
            canvas.style.display = 'none';
            document.getElementById('controls').style.display = 'none';
        }

        function showLogin() {
            gameState = 'login';
            document.getElementById('menu').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
        }

        function showCharacterScreen() {
            gameState = 'character';
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('characterScreen').style.display = 'block';
        }

        function showMapScreen() {
            gameState = 'map';
            document.getElementById('characterScreen').style.display = 'none';
            document.getElementById('mapScreen').style.display = 'block';
        }

        // Login/Registration (client-side)
        function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            if (username && password) {
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                if (users[username]) {
                    alert('Username already exists!');
                } else {
                    users[username] = password;
                    localStorage.setItem('users', JSON.stringify(users));
                    alert('Registered successfully! Please login.');
                }
            } else {
                alert('Please enter username and password.');
            }
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (users[username] === password) {
                currentUser = username;
                showCharacterScreen();
            } else {
                alert('Invalid username or password.');
            }
        }

        // Character and map selection
        function selectCharacter(type) {
            player = {
                x: MAP_WIDTH / 2,
                y: MAP_HEIGHT / 2,
                health: characters[type].health,
                maxHealth: characters[type].health,
                speed: characters[type].speed,
                bulletCooldown: characters[type].bulletCooldown,
                sprite: new Image(),
                lastShot: 0,
                type: type
            };
            player.sprite.src = characters[type].sprite;
            showMapScreen();
        }

        function selectMap(map) {
            currentMap = map;
            startGame();
        }

        // Start game
        function startGame() {
            gameState = 'playing';
            document.getElementById('mapScreen').style.display = 'none';
            canvas.style.display = 'block';
            document.getElementById('controls').style.display = 'block';

            // Initialize game
            bullets = [];
            score = 0;
            walls = maps[currentMap].walls;
            enemies = [
                { x: 100, y: 100, health: 50, speed: 2, size: 16, sprite: new Image() },
                { x: 700, y: 500, health: 80, speed: 1.5, size: 20, sprite: new Image() },
                { x: 400, y: 300, health: 30, speed: 3, size: 12, sprite: new Image() }
            ];
            enemies.forEach(e => e.sprite.src = 'https://via.placeholder.com/32/FF6666');
            powerUps = [];
            otherPlayers = [
                { x: 200, y: 200, health: 100, speed: 4, size: 16, sprite: new Image(), lastShot: 0, bulletCooldown: 1000 }
            ];
            otherPlayers.forEach(p => p.sprite.src = 'https://via.placeholder.com/32/6666FF');

            // Spawn power-ups periodically
            setInterval(spawnPowerUp, 10000);
        }

        // Power-up spawning
        function spawnPowerUp() {
            if (gameState !== 'playing') return;
            const types = ['health', 'speed'];
            const type = types[Math.floor(Math.random() * types.length)];
            powerUps.push({
                x: Math.random() * (MAP_WIDTH - POWERUP_SIZE * 2) + POWERUP_SIZE,
                y: Math.random() * (MAP_HEIGHT - POWERUP_SIZE * 2) + POWERUP_SIZE,
                type,
                sprite: new Image()
            });
            powerUps[powerUps.length - 1].sprite.src = type === 'health' ? 'https://via.placeholder.com/32/00FF00' : 'https://via.placeholder.com/32/FFFF00';
        }

        // Shoot bullet
        function shootBullet(shooter) {
            const dx = mouse.x - shooter.x;
            const dy = mouse.y - shooter.y;
            const mag = Math.sqrt(dx * dx + dy * dy);
            const vx = (dx / mag) * 10;
            const vy = (dy / mag) * 10;

            bullets.push({
                x: shooter.x,
                y: shooter.y,
                vx: vx,
                vy: vy,
                owner: shooter
            });
        }

        // Collision detection
        function checkCollision(x, y, size) {
            if (x < size || x > MAP_WIDTH - size || y < size || y > MAP_HEIGHT - size) return true;
            for (const wall of walls) {
                if (x + size > wall.x && x - size < wall.x + wall.width &&
                    y + size > wall.y && y - size < wall.y + wall.height) {
                    return true;
                }
            }
            return false;
        }

        // Update player
        function updatePlayer() {
            let dx = 0, dy = 0;
            if (keys['w']) dy -= player.speed;
            if (keys['s']) dy += player.speed;
            if (keys['a']) dx -= player.speed;
            if (keys['d']) dx += player.speed;

            const newX = player.x + dx;
            const newY = player.y + dy;
            if (!checkCollision(newX, newY, PLAYER_SIZE)) {
                player.x = newX;
                player.y = newY;
            }

            // Check power-up collision
            powerUps = powerUps.filter(p => {
                const dx = player.x - p.x;
                const dy = player.y - p.y;
                if (Math.sqrt(dx * dx + dy * dy) < PLAYER_SIZE + POWERUP_SIZE) {
                    if (p.type === 'health') player.health = Math.min(player.health + 50, player.maxHealth);
                    if (p.type === 'speed') player.speed *= 1.5; // Temporary boost
                    // const collectSound = new Audio('collect.mp3'); collectSound.play();
                    return false;
                }
                return true;
            });

            // Restart game
            if (player.health <= 0 && keys['r']) {
                showMenu();
            }
        }

        // Update bullets
        function updateBullets() {
            bullets = bullets.filter(bullet => {
                bullet.x += bullet.vx;
                bullet.y += bullet.vy;
                if (bullet.x < 0 || bullet.x > MAP_WIDTH || bullet.y < 0 || bullet.y > MAP_HEIGHT) return false;
                for (const wall of walls) {
                    if (bullet.x > wall.x && bullet.x < wall.x + wall.width &&
                        bullet.y > wall.y && bullet.y < wall.y + wall.height) {
                        return false;
                    }
                }
                return true;
            });

            // Bullet collisions
            bullets.forEach(bullet => {
                enemies.forEach(enemy => {
                    const dx = bullet.x - enemy.x;
                    const dy = bullet.y - enemy.y;
                    if (Math.sqrt(dx * dx + dy * dy) < enemy.size && bullet.owner !== enemy) {
                        enemy.health -= 10;
                        bullet.x = -100;
                        if (enemy.health <= 0) score += 10;
                    }
                });
                if (bullet.owner !== player) {
                    const dx = bullet.x - player.x;
                    const dy = bullet.y - player.y;
                    if (Math.sqrt(dx * dx + dy * dy) < PLAYER_SIZE) {
                        player.health -= 5;
                        bullet.x = -100;
                    }
                }
            });

            bullets = bullets.filter(b => b.x >= 0);
            enemies = enemies.filter(e => e.health > 0);
        }

        // Update enemies
        function updateEnemies() {
            enemies.forEach(enemy => {
                const dx = player.x - enemy.x;
                const dy = player.y - enemy.y;
                const mag = Math.sqrt(dx * dx + dy * dy);
                if (mag > 0) {
                    const newX = enemy.x + (dx / mag) * enemy.speed;
                    const newY = enemy.y + (dy / mag) * enemy.speed;
                    if (!checkCollision(newX, newY, enemy.size)) {
                        enemy.x = newX;
                        enemy.y = newY;
                    }
                }

                if (Math.sqrt(dx * dx + dy * dy) < PLAYER_SIZE + enemy.size) {
                    player.health -= 1;
                }
            });
        }

        // Update other players (simulated)
        function updateOtherPlayers() {
            otherPlayers.forEach(p => {
                const dx = player.x - p.x;
                const dy = player.y - p.y;
                const mag = Math.sqrt(dx * dx + dy * dy);
                if (mag > 0) {
                    const newX = p.x + (dx / mag) * p.speed * 0.5;
                    const newY = p.y + (dy / mag) * p.speed * 0.5;
                    if (!checkCollision(newX, newY, p.size)) {
                        p.x = newX;
                        p.y = newY;
                    }
                }
                if (Date.now() - p.lastShot > p.bulletCooldown) {
                    shootBullet(p);
                    p.lastShot = Date.now();
                }
            });
        }

        // Draw game
        function draw() {
            ctx.clearRect(0, 0, MAP_WIDTH, MAP_HEIGHT);

            // Draw walls
            ctx.fillStyle = '#666';
            walls.forEach(wall => ctx.fillRect(wall.x, wall.y, wall.width, wall.height));

            // Draw player
            if (player) {
                ctx.drawImage(player.sprite, player.x - PLAYER_SIZE, player.y - PLAYER_SIZE, PLAYER_SIZE * 2, PLAYER_SIZE * 2);
                ctx.fillStyle = 'red';
                ctx.fillRect(player.x - PLAYER_SIZE, player.y - PLAYER_SIZE - 10, (player.health / player.maxHealth) * PLAYER_SIZE * 2, 5);
            }

            // Draw enemies
            enemies.forEach(enemy => {
                ctx.drawImage(enemy.sprite, enemy.x - enemy.size, enemy.y - enemy.size, enemy.size * 2, enemy.size * 2);
                ctx.fillStyle = 'red';
                ctx.fillRect(enemy.x - enemy.size, enemy.y - enemy.size - 10, (enemy.health / 50) * enemy.size * 2, 5);
            });

            // Draw other players
            otherPlayers.forEach(p => {
                ctx.drawImage(p.sprite, p.x - p.size, p.y - p.size, p.size * 2, p.size * 2);
                ctx.fillStyle = 'blue';
                ctx.fillRect(p.x - p.size, p.y - p.size - 10, p.health / 100 * p.size * 2, 5);
            });

            // Draw bullets
            ctx.fillStyle = 'black';
            bullets.forEach(bullet => {
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, BULLET_SIZE, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw power-ups
            powerUps.forEach(p => {
                ctx.drawImage(p.sprite, p.x - POWERUP_SIZE, p.y - POWERUP_SIZE, POWERUP_SIZE * 2, POWERUP_SIZE * 2);
            });

            // Draw score
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Score: ${score}`, 10, 30);
            if (currentUser) ctx.fillText(`Player: ${currentUser}`, 10, 50);

            // Draw game over
            if (player && player.health <= 0) {
                ctx.fillStyle = 'black';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Game Over', MAP_WIDTH / 2, MAP_HEIGHT / 2);
                ctx.font = '24px Arial';
                ctx.fillText('Press R to Restart', MAP_WIDTH / 2, MAP_HEIGHT / 2 + 40);
            }
        }

        // Game loop
        function gameLoop() {
            if (gameState === 'playing' && player && player.health > 0) {
                updatePlayer();
                updateBullets();
                updateEnemies();
                updateOtherPlayers();
                draw();
            } else if (gameState === 'playing') {
                draw();
            }
            requestAnimationFrame(gameLoop);
        }

        // Start game loop
        gameLoop();
    </script>
</body>
</html>
